<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.meiliwan.emall.oms.dao.OrdDao" >
  <resultMap id="BaseResultMap" type="com.meiliwan.emall.oms.dto.OrdDTO" >
    <result column="order_id" property="orderId" jdbcType="VARCHAR" />
    <result column="order_comments" property="orderComments" jdbcType="VARCHAR" />
    <result column="order_type" property="orderType" jdbcType="VARCHAR" />
    <result column="real_pay_amount" property="realPayAmount" jdbcType="DECIMAL" />
    <result column="order_sale_amount" property="orderSaleAmount" jdbcType="DECIMAL" />
    <result column="order_pay_amount" property="orderPayAmount" jdbcType="DECIMAL" />
    <result column="favorable_total_amount" property="favorableTotalAmount" jdbcType="DECIMAL" />
    <result column="transport_fee" property="transportFee" jdbcType="DECIMAL" />
    <result column="is_invoice" property="isInvoice" jdbcType="TINYINT" />
    <result column="total_item" property="totalItem" jdbcType="TINYINT" />
    <result column="bill_type" property="billType" jdbcType="TINYINT" />
    <result column="client_id" property="clientId" jdbcType="VARCHAR" />
    <result column="uid" property="uid" jdbcType="INTEGER" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="order_status" property="orderStatus" jdbcType="VARCHAR" />
    <result column="recv_addr_id" property="recvAddrId" jdbcType="INTEGER" />
    <result column="recv_name" property="recvName" jdbcType="VARCHAR" />
    <result column="pay_code" property="payCode" jdbcType="VARCHAR" />
    <result column="pay_name" property="payName" jdbcType="VARCHAR" />
    <result column="pay_time" property="payTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="state" property="state" jdbcType="TINYINT" />
    <result column="exception_code" property="exceptionCode" jdbcType="VARCHAR" />
    <result column="remark_count" property="remarkCount" jdbcType="INTEGER" />
    <result column="print_pick_count" property="printPickCount" jdbcType="INTEGER" />
    <result column="print_send_count" property="printSendCount" jdbcType="INTEGER" />
    <result column="stock_time" property="stockTime" jdbcType="TIMESTAMP" />
      <result column="status_type" property="statusType" jdbcType="VARCHAR" />
      <result column="status_code" property="statusCode" jdbcType="VARCHAR" />
      <result column="logistics_company" property="logisticsCompany" jdbcType="VARCHAR" />
      <result column="logistics_number" property="logisticsNumber" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="BaseResultOmsOrd" type="com.meiliwan.emall.oms.bean.Ord" >
    <result column="order_id" property="orderId" jdbcType="VARCHAR" />
    <result column="order_comments" property="orderComments" jdbcType="VARCHAR" />
    <result column="order_type" property="orderType" jdbcType="VARCHAR" />
    <result column="real_pay_amount" property="realPayAmount" jdbcType="DECIMAL" />
    <result column="order_sale_amount" property="orderSaleAmount" jdbcType="DECIMAL" />
    <result column="order_pay_amount" property="orderPayAmount" jdbcType="DECIMAL" />
    <result column="favorable_total_amount" property="favorableTotalAmount" jdbcType="DECIMAL" />
    <result column="transport_fee" property="transportFee" jdbcType="DECIMAL" />
    <result column="is_invoice" property="isInvoice" jdbcType="TINYINT" />
    <result column="total_item" property="totalItem" jdbcType="TINYINT" />
    <result column="bill_type" property="billType" jdbcType="TINYINT" />
    <result column="client_id" property="clientId" jdbcType="VARCHAR" />
    <result column="uid" property="uid" jdbcType="INTEGER" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="order_status" property="orderStatus" jdbcType="VARCHAR" />
    <result column="recv_addr_id" property="recvAddrId" jdbcType="INTEGER" />
    <result column="recv_name" property="recvName" jdbcType="VARCHAR" />
    <result column="pay_time" property="payTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="state" property="state" jdbcType="TINYINT" />
    <result column="exception_code" property="exceptionCode" jdbcType="VARCHAR" />
    <result column="remark_count" property="remarkCount" jdbcType="INTEGER" />
    <result column="print_pick_count" property="printPickCount" jdbcType="INTEGER" />
    <result column="print_send_count" property="printSendCount" jdbcType="INTEGER" />
    <result column="stock_time" property="stockTime" jdbcType="TIMESTAMP" />
  </resultMap>

  <sql id="Base_Column_List" >
    o.order_id, o.order_comments, o.order_type, o.real_pay_amount, o.order_sale_amount, 
    o.order_pay_amount,o.favorable_total_amount, o.transport_fee, o.is_invoice, o.total_item, o.bill_type, o.client_id, o.uid,
    o.user_name, o.order_status, o.recv_addr_id,o.recv_name, o.pay_time, o.update_time, o.create_time, o.state, o.exception_code, o.remark_count, o.print_pick_count, o.print_send_count, o.stock_time
  </sql>
    <sql id="distinct_orderid_Column_List" >
    distinct o.order_id, o.order_comments, o.order_type, o.real_pay_amount, o.order_sale_amount,
    o.order_pay_amount,o.favorable_total_amount, o.transport_fee, o.is_invoice, o.total_item, o.bill_type, o.client_id, o.uid,
    o.user_name, o.order_status, o.recv_addr_id,o.recv_name, o.pay_time, o.update_time, o.create_time, o.state, o.exception_code, o.remark_count, o.print_pick_count, o.print_send_count, o.stock_time
  </sql>
    <select id="selectOrdSeq" resultType="java.lang.Integer">
       SELECT nextval('OrdSeq');
    </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultOmsOrd" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from oms_ord o
    where o.order_id = #{orderId,jdbcType=VARCHAR}
  </select>
  <select id="selectByPrimaryKeys" resultMap="BaseResultOmsOrd">
        select
        <include refid="Base_Column_List" />
        from oms_ord o
        where o.order_id IN
      <foreach item="item" index="index" collection="list"
               open="(" separator="," close=")">
          #{item}
      </foreach>
  </select>
  <update id="updateOrdStatus" parameterType="com.meiliwan.emall.oms.bean.Ord" >
    update oms_ord set order_status = #{orderStatus,jdbcType=VARCHAR}, update_time = #{updateTime,jdbcType=TIMESTAMP}
      <if test="orderType != null" >
          , order_type = #{orderType,jdbcType=VARCHAR}
      </if>
      <if test="payTime != null" >
          , pay_time = #{payTime,jdbcType=TIMESTAMP}
      </if>
    where order_id = #{orderId,jdbcType=VARCHAR}
  </update>
  <delete id="deleteByPrimaryKey" parameterType="com.meiliwan.emall.oms.bean.Ord" >
    update oms_ord set state=#{state,jdbcType=TINYINT}, update_time = #{updateTime,jdbcType=TIMESTAMP}
    where order_id = #{orderId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.meiliwan.emall.oms.bean.Ord" >
    insert into oms_ord (order_id, order_comments, 
      order_type, real_pay_amount, order_sale_amount, 
      order_pay_amount, favorable_total_amount, transport_fee, is_invoice,
      total_item, bill_type, client_id, 
      uid, user_name, order_status, recv_addr_id, recv_name, pay_time, update_time,
      create_time, state, exception_code, remark_count, print_pick_count, print_send_count, stock_time)
    values (#{orderId,jdbcType=VARCHAR}, #{orderComments,jdbcType=VARCHAR}, 
      #{orderType,jdbcType=VARCHAR}, #{realPayAmount,jdbcType=DECIMAL}, #{orderSaleAmount,jdbcType=DECIMAL}, 
      #{orderPayAmount,jdbcType=DECIMAL}, #{favorableTotalAmount,jdbcType=DECIMAL}, #{transportFee,jdbcType=DECIMAL}, #{isInvoice,jdbcType=TINYINT},
      #{totalItem,jdbcType=TINYINT}, #{billType,jdbcType=TINYINT}, #{clientId,jdbcType=VARCHAR}, 
      #{uid,jdbcType=INTEGER}, #{userName,jdbcType=VARCHAR}, #{orderStatus,jdbcType=VARCHAR}, #{recvAddrId,jdbcType=INTEGER}, #{recvName,jdbcType=VARCHAR},
      #{payTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, #{createTime,jdbcType=TIMESTAMP}, #{state,jdbcType=TINYINT}, #{exceptionCode,jdbcType=VARCHAR},
      #{remarkCount,jdbcType=INTEGER}, #{printPickCount,jdbcType=INTEGER}, #{printSendCount,jdbcType=INTEGER}, #{stockTime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.meiliwan.emall.oms.bean.Ord" >
    insert into oms_ord
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="orderId != null" >
        order_id,
      </if>
      <if test="orderComments != null" >
        order_comments,
      </if>
      <if test="orderType != null" >
        order_type,
      </if>
      <if test="realPayAmount != null" >
        real_pay_amount,
      </if>
      <if test="orderSaleAmount != null" >
        order_sale_amount,
      </if>
      <if test="orderPayAmount != null" >
        order_pay_amount,
      </if>
        <if test="favorableTotalAmount != null" >
            favorable_total_amount,
        </if>
      <if test="transportFee != null" >
        transport_fee,
      </if>
      <if test="isInvoice != null" >
        is_invoice,
      </if>
      <if test="totalItem != null" >
        total_item,
      </if>
      <if test="billType != null" >
        bill_type,
      </if>
      <if test="clientId != null" >
        client_id,
      </if>
      <if test="uid != null" >
        uid,
      </if>
      <if test="userName != null" >
        user_name,
      </if>
      <if test="orderStatus != null" >
        order_status,
      </if>
      <if test="recvAddrId != null" >
        recv_addr_id,
      </if>
        <if test="recvName != null" >
            recv_name,
        </if>
      <if test="payTime != null" >
        pay_time,
      </if>
      <if test="updateTime != null" >
        update_time,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="state != null" >
        state,
      </if>
      <if test="exceptionCode != null" >
        exception_code,
      </if>
      <if test="remarkCount != null" >
        remark_count,
      </if>
      <if test="printPickCount != null" >
        print_pick_count,
      </if>
      <if test="printSendCount != null" >
        print_send_count,
      </if>
      <if test="stockTime != null" >
        stock_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="orderId != null" >
        #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="orderComments != null" >
        #{orderComments,jdbcType=VARCHAR},
      </if>
      <if test="orderType != null" >
        #{orderType,jdbcType=VARCHAR},
      </if>
      <if test="realPayAmount != null" >
        #{realPayAmount,jdbcType=DECIMAL},
      </if>
      <if test="orderSaleAmount != null" >
        #{orderSaleAmount,jdbcType=DECIMAL},
      </if>
      <if test="orderPayAmount != null" >
        #{orderPayAmount,jdbcType=DECIMAL},
      </if>
        <if test="favorableTotalAmount != null" >
            #{favorableTotalAmount,jdbcType=DECIMAL},
        </if>
      <if test="transportFee != null" >
        #{transportFee,jdbcType=DECIMAL},
      </if>
      <if test="isInvoice != null" >
        #{isInvoice,jdbcType=TINYINT},
      </if>
      <if test="totalItem != null" >
        #{totalItem,jdbcType=TINYINT},
      </if>
      <if test="billType != null" >
        #{billType,jdbcType=TINYINT},
      </if>
      <if test="clientId != null" >
        #{clientId,jdbcType=VARCHAR},
      </if>
      <if test="uid != null" >
        #{uid,jdbcType=INTEGER},
      </if>
      <if test="userName != null" >
        #{userName,jdbcType=VARCHAR},
      </if>
      <if test="orderStatus != null" >
        #{orderStatus,jdbcType=VARCHAR},
      </if>
      <if test="recvAddrId != null" >
        #{recvAddrId,jdbcType=INTEGER},
      </if>
        <if test="recvName != null" >
            #{recvName,jdbcType=VARCHAR},
        </if>
      <if test="payTime != null" >
        #{payTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="state != null" >
        #{state,jdbcType=TINYINT},
      </if>
        <if test="exceptionCode != null" >
            #{exceptionCode,jdbcType=VARCHAR},
        </if>
        <if test="remarkCount != null" >
            #{remarkCount,jdbcType=INTEGER},
        </if>
        <if test="printPickCount != null" >
            #{printPickCount,jdbcType=INTEGER},
        </if>
        <if test="printSendCount != null" >
            #{printSendCount,jdbcType=INTEGER},
        </if>
        <if test="stockTime != null" >
            #{stockTime,jdbcType=TIMESTAMP},
        </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.meiliwan.emall.oms.bean.Ord" >
    update oms_ord
    <set >  
      <if test="orderComments != null" >
        order_comments = #{orderComments,jdbcType=VARCHAR},
      </if>
      <if test="orderType != null" >
        order_type = #{orderType,jdbcType=VARCHAR},
      </if>
      <if test="realPayAmount != null" >
        real_pay_amount = #{realPayAmount,jdbcType=DECIMAL},
      </if>
      <if test="orderSaleAmount != null" >
        order_sale_amount = #{orderSaleAmount,jdbcType=DECIMAL},
      </if>
      <if test="orderPayAmount != null" >
        order_pay_amount = #{orderPayAmount,jdbcType=DECIMAL},
      </if>
        <if test="favorableTotalAmount != null" >
            favorable_total_amount = #{favorableTotalAmount,jdbcType=DECIMAL},
        </if>
      <if test="transportFee != null" >
        transport_fee = #{transportFee,jdbcType=DECIMAL},
      </if>
      <if test="isInvoice != null" >
        is_invoice = #{isInvoice,jdbcType=TINYINT},
      </if>
      <if test="totalItem != null" >
        total_item = #{totalItem,jdbcType=TINYINT},
      </if>
      <if test="billType != null" >
        bill_type = #{billType,jdbcType=TINYINT},
      </if>
      <if test="clientId != null" >
        client_id = #{clientId,jdbcType=VARCHAR},
      </if>
      <if test="uid != null" >
        uid = #{uid,jdbcType=INTEGER},
      </if>
      <if test="userName != null" >
        user_name = #{userName,jdbcType=VARCHAR},
      </if>
      <if test="orderStatus != null" >
        order_status = #{orderStatus,jdbcType=VARCHAR},
      </if>
      <if test="recvAddrId != null" >
        recv_addr_id = #{recvAddrId,jdbcType=INTEGER},
      </if>
        <if test="recvName != null" >
            recv_name =#{recvName,jdbcType=VARCHAR},
        </if>
      <if test="payTime != null" >
        pay_time = #{payTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="state != null" >
        state = #{state,jdbcType=TINYINT},
      </if>
        <if test="exceptionCode != null" >
            exception_code =#{exceptionCode,jdbcType=VARCHAR},
        </if>
        <if test="remarkCount != null" >
            remark_count =#{remarkCount,jdbcType=INTEGER},
        </if>
        <if test="printPickCount != null" >
            print_pick_count =#{printPickCount,jdbcType=INTEGER},
        </if>
        <if test="printSendCount != null" >
            print_send_count =#{printSendCount,jdbcType=INTEGER},
        </if>
        <if test="stockTime != null" >
            stock_time =#{stockTime,jdbcType=VARCHAR},
        </if>
    </set>
    where order_id = #{orderId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.meiliwan.emall.oms.bean.Ord" >
    update oms_ord
    set 
      order_comments = #{orderComments,jdbcType=VARCHAR},
      order_type = #{orderType,jdbcType=VARCHAR},
      real_pay_amount = #{realPayAmount,jdbcType=DECIMAL},
      order_sale_amount = #{orderSaleAmount,jdbcType=DECIMAL},
      order_pay_amount = #{orderPayAmount,jdbcType=DECIMAL},
      favorable_total_amount = #{favorableTotalAmount,jdbcType=DECIMAL},
      transport_fee = #{transportFee,jdbcType=DECIMAL},
      is_invoice = #{isInvoice,jdbcType=TINYINT},
      total_item = #{totalItem,jdbcType=TINYINT},
      bill_type = #{billType,jdbcType=TINYINT},
      client_id = #{clientId,jdbcType=VARCHAR},
      uid = #{uid,jdbcType=INTEGER},
      user_name = #{userName,jdbcType=VARCHAR},
      order_status = #{orderStatus,jdbcType=VARCHAR},
      recv_addr_id = #{recvAddrId,jdbcType=INTEGER},
      recv_name = #{recvName,jdbcType=VARCHAR},
      pay_time = #{payTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      state = #{state,jdbcType=TINYINT},
      exception_code = #{exceptionCode,jdbcType=VARCHAR},
      remark_count = #{remarkCount,jdbcType=INTEGER},
      print_pick_count = #{printPickCount,jdbcType=INTEGER},
      print_send_count = #{printSendCount,jdbcType=INTEGER},
      stock_time = #{stockTime,jdbcType=TIMESTAMP}
    where order_id = #{orderId,jdbcType=VARCHAR}
  </update>

  <select id="getOrdListByOrdStatus" resultMap="BaseResultMap" parameterType="com.meiliwan.emall.oms.dto.OrderQueryDTO" >
    select 
    <include refid="distinct_orderid_Column_List" />
    <if test="entity.payCode!=null">
 	 ,op.pay_code,op.pay_name
    </if>
      <if test="entity.statusType!=null and entity.statusType!='IS'">
          ,ois.status_type, ois.status_code ,ol.logistics_company, ol.logistics_number
      </if>
      from oms_ord o
      <if test="entity.payCode!=null">
       LEFT JOIN oms_ord_pay op ON o.order_id=op.order_id
      </if>
      <if test="entity.phone!=null">
          LEFT JOIN oms_ord_addr oa ON o.order_id=oa.order_id
      </if>
      <if test="entity.proName!=null || entity.proBarCode!=null || entity.buyType!=null || entity.proId &gt; 0">
          LEFT JOIN oms_ordi oi ON o.order_id=oi.order_id
      </if>
      <if test="entity.statusType!=null and entity.statusType!='IS'">
          RIGHT JOIN (select distinct ois.order_id, ois.status_type, ois.status_code, ois.state from oms_ordi_status ois
          WHERE ois.status_type= #{entity.statusType,jdbcType=VARCHAR}
          <if test="entity.orderItemStatus != null" >
              and ois.status_code= #{entity.orderItemStatus,jdbcType=VARCHAR}
          </if>
          ) as ois ON o.order_id=ois.order_id
      </if>
      <if test="entity.statusType!=null and entity.statusType!='IS'">
              <if test="entity.logisticsCompany!=null" >
                  RIGHT JOIN (select distinct ol.order_id, ol.logistics_company, ol.logistics_number from oms_ord_logistics ol
                  where ol.logistics_company= #{entity.logisticsCompany,jdbcType=VARCHAR}
              </if>
              <if test="entity.logisticsCompany==null" >
                  LEFT JOIN (select distinct ol.order_id, ol.logistics_company, ol.logistics_number from oms_ord_logistics ol
              </if>
              ) as ol  ON o.order_id=ol.order_id
      </if>
    <include refid="selectCondition" />
        <if test="orderBy!=null">
            order by ${orderBy}
        </if>
        <if test="pageInfo!=null">
            limit ${pageInfo.startIndex} ,${pageInfo.pagesize}
        </if>
  </select>
    <select id="getTotalByEntity"
            resultType="java.lang.Integer">
        select count(distinct o.order_id) from oms_ord o
        <if test="entity.payCode!=null">
            LEFT JOIN oms_ord_pay op ON o.order_id=op.order_id
        </if>
        <if test="entity.phone!=null">
            LEFT JOIN oms_ord_addr oa ON o.order_id=oa.order_id
        </if>
        <if test="entity.proName!=null || entity.proBarCode!=null || entity.buyType!=null || entity.proId &gt; 0">
            LEFT JOIN oms_ordi oi ON o.order_id=oi.order_id
        </if>
        <if test="entity.statusType!=null and entity.statusType!='IS'">
            RIGHT JOIN (select distinct ois.order_id, ois.status_type, ois.status_code, ois.state from oms_ordi_status ois
            WHERE ois.status_type= #{entity.statusType,jdbcType=VARCHAR}
            <if test="entity.orderItemStatus != null" >
                and ois.status_code= #{entity.orderItemStatus,jdbcType=VARCHAR}
            </if>
            ) as ois ON o.order_id=ois.order_id
        </if>
        <if test="entity.logisticsNumber!=null || entity.logisticsCompany!=null">
            <if test="entity.logisticsCompany!=null" >
                RIGHT JOIN (select distinct ol.order_id, ol.logistics_company, ol.logistics_number from oms_ord_logistics ol
                where ol.logistics_company= #{entity.logisticsCompany,jdbcType=VARCHAR}
            </if>
            <if test="entity.logisticsCompany==null" >
                LEFT JOIN (select distinct ol.order_id, ol.logistics_company, ol.logistics_number from oms_ord_logistics ol
            </if>
            ) as ol  ON o.order_id=ol.order_id
        </if>
        <include refid="selectCondition" />
    </select>
    <select id="getOrdGroupCountByOrdStatus" resultType="java.util.Map" parameterType="com.meiliwan.emall.oms.dto.OrderQueryDTO" >
        select count(distinct o.order_id) as total, ois.status_code
        from oms_ord o
        <if test="entity.payCode!=null">
            LEFT JOIN oms_ord_pay op ON o.order_id=op.order_id
        </if>
        <if test="entity.phone!=null">
            LEFT JOIN oms_ord_addr oa ON o.order_id=oa.order_id
        </if>
        <if test="entity.proName!=null || entity.proBarCode!=null || entity.buyType!=null || entity.proId &gt; 0">
            LEFT JOIN oms_ordi oi ON o.order_id=oi.order_id
        </if>
        RIGHT JOIN (select distinct ois.order_id, ois.status_type, ois.status_code, ois.state from oms_ordi_status ois
        WHERE ois.status_type= #{entity.statusType,jdbcType=VARCHAR}
        <if test="entity.orderItemStatus != null" >
            and ois.status_code= #{entity.orderItemStatus,jdbcType=VARCHAR}
        </if>
        ) as ois ON o.order_id=ois.order_id
        <if test="entity.logisticsNumber!=null || entity.logisticsCompany!=null">
            <if test="entity.logisticsCompany!=null" >
                RIGHT JOIN (select distinct ol.order_id, ol.logistics_company, ol.logistics_number from oms_ord_logistics ol
                where ol.logistics_company= #{entity.logisticsCompany,jdbcType=VARCHAR}
            </if>
            <if test="entity.logisticsCompany==null" >
                LEFT JOIN (select distinct ol.order_id, ol.logistics_company, ol.logistics_number from oms_ord_logistics ol
            </if>
            ) as ol  ON o.order_id=ol.order_id
        </if>
        <include refid="selectCondition" />
         GROUP BY ois.status_code
    </select>

  <sql id="selectCondition">
        <where>
            <trim suffixOverrides="and">
                <if test="entity != null">
                    <if test="entity.orderId!=null" >
                        and o.order_id= #{entity.orderId,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.orderTimeStart != null" >
                        and o.create_time &gt;= #{entity.orderTimeStart,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.orderTimeEnd != null" >
                        and o.create_time &lt;= #{entity.orderTimeEnd,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.realPayAmountMin != null and entity.realPayAmountMin &gt;0" >
                        and o.real_pay_amount &gt;= #{entity.realPayAmountMin,jdbcType=DECIMAL}
                    </if>
                    <if test="entity.realPayAmountMax != null and entity.realPayAmountMax &gt;0" >
                        and o.real_pay_amount &lt;= #{entity.realPayAmountMax,jdbcType=DECIMAL}
                    </if>
                    <if test="entity.payCode!=null" >
                        and op.pay_code= #{entity.payCode,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.billType != null" >
                        and o.bill_type= #{entity.billType,jdbcType=TINYINT}
                    </if>
                    <if test="entity.state != null" >
                        and o.state= #{entity.state,jdbcType=TINYINT}
                    <if test="entity.statusType!=null and entity.statusType!='' and entity.statusType!='IS'">
                        and ois.state= #{entity.state,jdbcType=TINYINT}
                    </if>
                    </if>
                    <if test="entity.recvName != null">
                        and o.recv_name like #{entity.recvName,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.exceptionCode != null">
                        and o.exception_code is not null
                    </if>
                    <if test="entity.uid != null">
                        and o.uid = #{entity.uid,jdbcType=INTEGER}
                    </if>
                    <if test="entity.stockTimeStart != null" >
                        and o.stock_time &gt;= #{entity.stockTimeStart,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.stockTimeEnd != null" >
                        and o.stock_time &lt;= #{entity.stockTimeEnd,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.remarkCount==1">
                        and o.remark_count &gt; 0
                    </if>
                    <if test="entity.remarkCount==2">
                        and o.remark_count = 0
                    </if>
                    <if test="entity.printPickCount==1">
                        and o.print_pick_count &gt; 0
                    </if>
                    <if test="entity.printSendCount==1">
                        and o.print_send_count &gt; 0
                    </if>
                    <if test="entity.logisticsNumber != null" >
                        and ol.logistics_number= #{entity.logisticsNumber,jdbcType=VARCHAR}
                    </if>
                    <if test="(entity.orderItemStatus != null and entity.statusType==null) || (entity.orderItemStatus != null and entity.statusType=='') || (entity.orderItemStatus != null and entity.statusType=='IS')" >
                        and o.order_status= #{entity.orderItemStatus,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.proName!=null">
                        and oi.pro_name like #{entity.proName,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.proBarCode!=null">
                        and oi.pro_bar_code = #{entity.proBarCode,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.buyType!=null">
                        and oi.buy_type like #{entity.buyType,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.proId &gt;0">
                        and oi.pro_id = #{entity.proId,jdbcType=INTEGER}
                    </if>
                    <if test="entity.phone!=null">
                        and (oa.mobile = #{entity.phone,jdbcType=VARCHAR} or oa.phone = #{entity.phone,jdbcType=VARCHAR})
                    </if>
                    <if test="entity.isInvoice != null and entity.isInvoice &gt;= 0">
                        and o.is_invoice = #{entity.isInvoice,jdbcType=INTEGER}
                    </if>
                    <!-- add by lzl 140421 -->
                    <if test="entity.updateTimeStart != null" >
                        and o.update_time &gt;= #{entity.updateTimeStart,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.updateTimeEnd != null" >
                        and o.update_time &lt;= #{entity.updateTimeEnd,jdbcType=TIMESTAMP}
                    </if>
                    <!-- add by lzl 140505 -->
                    <!-- add by lzl 140610 -->
                    <if test="entity.payTimeStart != null" >
                        and o.pay_time &gt;= #{entity.payTimeStart,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.payTimeEnd != null" >
                        and o.pay_time &lt;= #{entity.payTimeEnd,jdbcType=TIMESTAMP}
                    </if>
                    <!-- add by lzl 1400610 -->
                    <if test="entity.orderType != null" >
                    	<if test="entity.orderType != 'RPT'" >
                        	and o.order_type = #{entity.orderType,jdbcType=VARCHAR}
                        </if>
                        <if test="entity.orderType == 'RPT'" >
                        	and o.order_type != 'RPS'
                        </if>
                    </if>
                    <if test="entity.orderExpansion != null" >
                        <if test="entity.orderExpansion == 'NO_CANCEL'" >
                        	and o.order_status != '80'
                        </if>
                    </if>
                </if>
            </trim>
            <trim suffixOverrides="and">
                <if test="whereSql!=null">
                    and ${whereSql}
                </if>
            </trim>
        </where>
    </sql>
    <sql id="selectConditionBean">
        <where>
            <trim suffixOverrides="and">
                <if test="entity != null">
                    <if test="entity.orderId != null and entity.orderId &gt;0" >
                        and order_id = #{entity.orderId,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.billType != null" >
                        and bill_type = #{entity.billType,jdbcType=TINYINT}
                    </if>
                    <if test="entity.state != null" >
                        and state = #{entity.state,jdbcType=TINYINT}
                    </if>
                    <if test="entity.uid != null" >
                        and uid = #{entity.uid,jdbcType=INTEGER}
                    </if>
                </if>
            </trim>
            <trim suffixOverrides="and">
                <if test="whereSql!=null">
                    and ${whereSql}
                </if>
            </trim>
        </where>
    </sql>
    <!-- 根据条件查询 -->
    <select id="getListByEntityAndPageInfo"
            resultMap="BaseResultOmsOrd">
        select order_id, create_time, order_status, uid, recv_addr_id
        from oms_ord
        <include refid="selectConditionBean"/>
        <if test="orderBy!=null">
            ${orderBy}
        </if>
        <if test="pageInfo!=null">
            limit ${pageInfo.startIndex} ,${pageInfo.pagesize}
        </if>
    </select>

    <!-- 查询总数 -->
    <select id="getTotalByBean"
            resultType="java.lang.Integer">
        select count(*) from oms_ord
        <include refid="selectConditionBean"/>
    </select>




    <sql id="selectConditionForFrontUser">
        <where>
            <trim suffixOverrides="and">
                <if test="entity != null">
                    <if test="entity.orderId!=null" >
                        and o.order_id= #{entity.orderId,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.orderTimeStart != null" >
                        and o.create_time &gt;= #{entity.orderTimeStart,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.orderTimeEnd != null" >
                        and o.create_time &lt;= #{entity.orderTimeEnd,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.realPayAmountMin != null and entity.realPayAmountMin &gt;0" >
                        and o.real_pay_amount &gt;= #{entity.realPayAmountMin,jdbcType=DECIMAL}
                    </if>
                    <if test="entity.realPayAmountMax != null and entity.realPayAmountMax &gt;0" >
                        and o.real_pay_amount &lt;= #{entity.realPayAmountMax,jdbcType=DECIMAL}
                    </if>
                    <if test="entity.payCode!=null" >
                        and op.pay_code= #{entity.payCode,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.billType != null" >
                        and o.bill_type= #{entity.billType,jdbcType=TINYINT}
                    </if>
                    <if test="entity.state != null" >
                        and o.state= #{entity.state,jdbcType=TINYINT}
                        <if test="entity.statusType!=null and entity.statusType!='' and entity.statusType!='IS'">
                            and ois.state= #{entity.state,jdbcType=TINYINT}
                        </if>
                    </if>
                    <if test="entity.recvName != null">
                        and o.recv_name like #{entity.recvName,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.exceptionCode != null">
                        and o.exception_code is not null
                    </if>
                    <if test="entity.uid != null">
                        and o.uid = #{entity.uid,jdbcType=INTEGER}
                    </if>
                    <if test="entity.stockTimeStart != null" >
                        and o.stock_time &gt;= #{entity.stockTimeStart,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.stockTimeEnd != null" >
                        and o.stock_time &lt;= #{entity.stockTimeEnd,jdbcType=TIMESTAMP}
                    </if>
                    <if test="entity.remarkCount==1">
                        and o.remark_count &gt; 0
                    </if>
                    <if test="entity.remarkCount==2">
                        and o.remark_count = 0
                    </if>
                    <if test="entity.printPickCount==1">
                        and o.print_pick_count &gt; 0
                    </if>
                    <if test="entity.printSendCount==1">
                        and o.print_send_count &gt; 0
                    </if>
                    <if test="entity.logisticsNumber != null" >
                        and ol.logistics_number= #{entity.logisticsNumber,jdbcType=VARCHAR}
                    </if>
                    <if test="(entity.orderItemStatus != null and entity.statusType==null) || (entity.orderItemStatus != null and entity.statusType=='') || (entity.orderItemStatus != null and entity.statusType=='IS')" >
                        and o.order_status= #{entity.orderItemStatus,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.proBarCode!=null">
                        and oi.pro_bar_code = #{entity.proBarCode,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.buyType!=null">
                        and oi.buy_type like #{entity.buyType,jdbcType=VARCHAR}
                    </if>
                    <if test="entity.proId &gt;0">
                        and oi.pro_id = #{entity.proId,jdbcType=INTEGER}
                    </if>
                    <if test="entity.phone!=null">
                        and (oa.mobile = #{entity.phone,jdbcType=VARCHAR} or oa.phone = #{entity.phone,jdbcType=VARCHAR})
                    </if>
                    <if test="entity.isInvoice != null and entity.isInvoice &gt;= 0">
                        and o.is_invoice = #{entity.isInvoice,jdbcType=INTEGER}
                    </if>
                </if>
            </trim>
            <trim suffixOverrides="and">
                <if test="whereSql!=null">
                    and ${whereSql}
                </if>
            </trim>
        </where>
    </sql>
    <select id="getOrdListByOrdStatusForFrontUser" resultMap="BaseResultMap" parameterType="com.meiliwan.emall.oms.dto.OrderQueryDTO" >
        select
        <include refid="Base_Column_List" />
        from oms_ord o
        <if test="entity.proBarCode!=null || entity.proId &gt; 0">
            LEFT JOIN oms_ordi oi ON o.order_id=oi.order_id
        </if>
        <if test="entity.proName!=null">
            RIGHT JOIN (select distinct oi.order_id from oms_ordi oi where oi.pro_name like #{entity.proName,jdbcType=VARCHAR}) as oi ON o.order_id=oi.order_id
        </if>
        <include refid="selectConditionForFrontUser" />
        <if test="orderBy!=null">
            order by ${orderBy}
        </if>
        <if test="pageInfo!=null">
            limit ${pageInfo.startIndex} ,${pageInfo.pagesize}
        </if>
    </select>
    <select id="getTotalByEntityForFrontUser"
            resultType="java.lang.Integer">
        select count(*) from oms_ord o
        <if test="entity.proBarCode!=null || entity.proId &gt; 0">
            LEFT JOIN oms_ordi oi ON o.order_id=oi.order_id
        </if>
        <if test="entity.proName!=null">
            RIGHT JOIN (select distinct oi.order_id from oms_ordi oi where oi.pro_name like #{entity.proName,jdbcType=VARCHAR}) as oi ON o.order_id=oi.order_id
        </if>
        <include refid="selectConditionForFrontUser" />
    </select>

    <select id="getOrdDTOListByIds" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        , ol.logistics_company, ol.logistics_number
        from oms_ord o
        LEFT JOIN (select distinct ol.order_id, ol.logistics_company, ol.logistics_number from oms_ord_logistics ol ) as ol ON o.order_id=ol.order_id
        where o.order_id IN
        <foreach item="item" index="index" collection="list"
                 open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>
    
    <!-- add by lzl 140421 -->
    <select id="getOrdAndOrdiByQuery" resultMap="BaseResultOmsOrd" parameterType="com.meiliwan.emall.oms.dto.OrderQueryDTO">
    	select 
    	<include refid="Base_Column_List" />
    	from oms_ord o 
    	<include refid="selectCondition" />
    	
    	<if test="entity.sort != null">
    		order by #{entity.sort,jdbcType=VARCHAR})
    	</if>
    	<if test="pageInfo!=null">
            limit ${pageInfo.startIndex} ,${pageInfo.pagesize}
        </if>
    </select>

</mapper>